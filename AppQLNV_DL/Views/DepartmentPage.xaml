<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:AppQLNV_DL.ViewModels"
             x:Class="AppQLNV_DL.Views.DepartmentPage"
             Title="Quáº£n lÃ½ PhÃ²ng Ban"
             BackgroundColor="#F5F6FA">
    <!-- MÃ u ná»n xÃ¡m nháº¡t hiá»‡n Ä‘áº¡i -->

    <ContentPage.BindingContext>
        <viewmodels:DepartmentViewModel/>
    </ContentPage.BindingContext>

    <Grid RowDefinitions="Auto, *">
        <!-- 1. Thanh tÃ¬m kiáº¿m á»Ÿ trÃªn cÃ¹ng (GiÃºp giao diá»‡n trÃ´ng Pro hÆ¡n) -->
        <Border Grid.Row="0" 
                Margin="15,10,15,5"
                StrokeShape="RoundRectangle 25"
                StrokeThickness="0"
                BackgroundColor="White"
                HeightRequest="50">
            <Border.Shadow>
                <Shadow Brush="Black" Offset="0,2" Radius="5" Opacity="0.05"/>
            </Border.Shadow>
            <Grid ColumnDefinitions="Auto, *">
                <Label Text="ðŸ”" VerticalOptions="Center" Margin="15,0,10,0" FontSize="16"/>
                <Entry Grid.Column="1" 
                       Placeholder="TÃ¬m kiáº¿m phÃ²ng ban..." 
                       VerticalOptions="Center"
                       FontSize="14"
                       TextColor="#2D3436"/>
            </Grid>
        </Border>

        <!-- 2. Logo ná»n áº©n nháº¹ -->
        <Image Grid.Row="1"
               Source="logo.png"
               Aspect="AspectFit"
               WidthRequest="250"
               HorizontalOptions="Center"
               VerticalOptions="Center"
               Opacity="0.04"
               ZIndex="-1"
               InputTransparent="True"/>

        <!-- 3. Danh sÃ¡ch phÃ²ng ban -->
        <RefreshView Grid.Row="1"
                     IsRefreshing="{Binding IsRefreshing}"
                     Command="{Binding RefreshCommand}"
                     RefreshColor="RoyalBlue">

            <CollectionView ItemsSource="{Binding Departments}" 
                            SelectionMode="None"
                            Margin="15,5,15,15">

                <CollectionView.ItemsLayout>
                    <LinearItemsLayout Orientation="Vertical" ItemSpacing="12"/>
                </CollectionView.ItemsLayout>

                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Border StrokeShape="RoundRectangle 15"
                                StrokeThickness="0"
                                BackgroundColor="White">
                            <Border.Shadow>
                                <Shadow Brush="Black" Offset="0,3" Radius="8" Opacity="0.08"/>
                            </Border.Shadow>

                            <!-- ThÃªm Gesture Ä‘á»ƒ nháº¥n vÃ o báº¥t cá»© Ä‘Ã¢u trÃªn tháº» cÅ©ng má»Ÿ Ä‘Æ°á»£c danh sÃ¡ch -->
                            <Border.GestureRecognizers>
                                <TapGestureRecognizer 
                                    Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:DepartmentViewModel}}, Path=DepartmentSelectedCommand}"
                                    CommandParameter="{Binding .}"/>
                            </Border.GestureRecognizers>

                            <Grid ColumnDefinitions="6, *, Auto">
                                <!-- Thanh mÃ u accent má»ng bÃªn trÃ¡i -->
                                <BoxView Grid.Column="0" 
                                         BackgroundColor="RoyalBlue" 
                                         CornerRadius="15,0,0,15"
                                         VerticalOptions="Fill"/>

                                <HorizontalStackLayout Grid.Column="1" 
                                                       Spacing="15" 
                                                       Padding="15,18">
                                    <Label Text="ðŸ¢" FontSize="26" VerticalOptions="Center"/>

                                    <VerticalStackLayout VerticalOptions="Center" Spacing="2">
                                        <Label Text="{Binding DepartmentName}"
                                               FontSize="17"
                                               FontAttributes="Bold"
                                               TextColor="#2D3436"/>
                                        <Label Text="Nháº¥n Ä‘á»ƒ xem danh sÃ¡ch" 
                                               FontSize="11" 
                                               TextColor="#95A5A6"/>
                                    </VerticalStackLayout>
                                </HorizontalStackLayout>

                                <!-- NÃºt Chi tiáº¿t nháº¹ nhÃ ng hÆ¡n -->
                                <Label Grid.Column="2" 
                                       Text="â¯" 
                                       TextColor="#BDC3C7" 
                                       FontSize="20" 
                                       VerticalOptions="Center" 
                                       Margin="0,0,20,0"/>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </RefreshView>

        <!-- 4. Floating Action Button (FAB) -->
        <Border Grid.Row="1"
                HorizontalOptions="End"
                VerticalOptions="End"
                Margin="25"
                WidthRequest="60"
                HeightRequest="60"
                StrokeShape="RoundRectangle 30"
                BackgroundColor="RoyalBlue"
                StrokeThickness="0">
            <Border.Shadow>
                <Shadow Brush="RoyalBlue" Offset="0,4" Radius="12" Opacity="0.4"/>
            </Border.Shadow>
            <Border.GestureRecognizers>
                <TapGestureRecognizer Tapped="OnAddEmployeeClicked"/>
            </Border.GestureRecognizers>

            <Label Text="+" 
                   TextColor="White" 
                   FontSize="32" 
                   HorizontalOptions="Center" 
                   VerticalOptions="Center"
                   Margin="0,0,0,4"/>
        </Border>

        <!-- 5. VÃ²ng xoay loading -->
        <ActivityIndicator Grid.Row="1"
                           IsRunning="{Binding IsBusy}"
                           IsVisible="{Binding IsBusy}"
                           VerticalOptions="Center"
                           HorizontalOptions="Center"
                           Color="RoyalBlue"
                           WidthRequest="50"
                           HeightRequest="50" />
    </Grid>
</ContentPage>