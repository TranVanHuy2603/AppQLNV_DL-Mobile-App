<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:AppQLNV_DL.ViewModels"
             xmlns:models="clr-namespace:AppQLNV_DL.Models"
             x:Class="AppQLNV_DL.Views.JobPage"
             x:DataType="vm:JobViewModel"
             Title="Danh sÃ¡ch CÃ´ng viá»‡c">

    <Grid BackgroundColor="#F8F9FA">
        <RefreshView IsRefreshing="{Binding IsRefreshing}"
                     Command="{Binding RefreshCommand}"
                     RefreshColor="RoyalBlue">

            <CollectionView ItemsSource="{Binding Jobs}"
                            SelectionMode="None">
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:Job">
                        <Border StrokeShape="RoundRectangle 12" 
                                StrokeThickness="0.5" 
                                Stroke="#D0D0D0"
                                BackgroundColor="White" 
                                Padding="15" 
                                Margin="0,0,0,12">

                            <Border.Shadow>
                                <Shadow Brush="Black" Offset="0,2" Radius="6" Opacity="0.08"/>
                            </Border.Shadow>

                            <!-- GRID CHIA Cá»˜T: TRÃI (THÃ”NG TIN), PHáº¢I (NÃšT) - TÄƒng cá»™t nÃºt lÃªn 85 Ä‘á»ƒ Ä‘á»§ chá»¯ -->
                            <Grid ColumnDefinitions="*, 85" ColumnSpacing="10">

                                <!-- Cá»˜T TRÃI: THÃ”NG TIN CHI TIáº¾T -->
                                <VerticalStackLayout Grid.Column="0" Spacing="6">

                                    <!-- Äá»ŠA ÄIá»‚M -->
                                    <Label Text="{Binding Location}" 
                                           FontSize="20" 
                                           FontAttributes="Bold" 
                                           TextColor="#1A252F"
                                           LineBreakMode="WordWrap"/>

                                    <!-- BADGES -->
                                    <HorizontalStackLayout Spacing="6">
                                        <Border BackgroundColor="#E9F5EA" Padding="10,4" StrokeShape="RoundRectangle 6">
                                            <Label Text="{Binding ServiceName}" FontSize="13" TextColor="#2E7D32" FontAttributes="Bold"/>
                                        </Border>
                                        <Border BackgroundColor="#E3F2FD" Padding="10,4" StrokeShape="RoundRectangle 6">
                                            <Label Text="{Binding DeviceName}" FontSize="13" TextColor="#1565C0" FontAttributes="Bold"/>
                                        </Border>
                                    </HorizontalStackLayout>

                                    <!-- KHá»I CHI TIáº¾T KÃˆM NHÃƒN CHá»® -->
                                    <VerticalStackLayout Spacing="5" Margin="0,5">

                                        <!-- DÃ²ng NhÃ¢n viÃªn -->
                                        <HorizontalStackLayout Spacing="8">
                                            <Label Text="ðŸ‘¤" FontSize="18" VerticalOptions="Center" WidthRequest="22"/>
                                            <Label Text="NhÃ¢n viÃªn:" FontSize="15" TextColor="Gray" VerticalOptions="Center"/>
                                            <Label Text="{Binding EmployeeName}" FontSize="16" FontAttributes="Bold" TextColor="#34495E" VerticalOptions="Center"/>
                                        </HorizontalStackLayout>

                                        <!-- DÃ²ng LiÃªn há»‡ -->
                                        <HorizontalStackLayout Spacing="8">
                                            <Label Text="ðŸ“ž" FontSize="18" VerticalOptions="Center" WidthRequest="22"/>
                                            <Label Text="LiÃªn há»‡:" FontSize="15" TextColor="Gray" VerticalOptions="Center"/>
                                            <Label Text="{Binding CustomerPhone}" FontSize="17" TextColor="#4169E1" FontAttributes="Bold" VerticalOptions="Center"/>
                                        </HorizontalStackLayout>

                                        <!-- DÃ²ng Thá»i gian -->
                                        <HorizontalStackLayout Spacing="8">
                                            <Label Text="â°" FontSize="18" VerticalOptions="Center" WidthRequest="22"/>
                                            <Label Text="Thá»i gian:" FontSize="15" TextColor="Gray" VerticalOptions="Center"/>
                                            <Label Text="{Binding AssignedDate, StringFormat='{0:dd/MM/yyyy HH:mm}'}" FontSize="15" TextColor="#555" VerticalOptions="Center"/>
                                        </HorizontalStackLayout>

                                        <!-- DÃ²ng Ghi chÃº -->
                                        <HorizontalStackLayout Spacing="8">
                                            <Label Text="ðŸ“" FontSize="18" VerticalOptions="Start" WidthRequest="22"/>
                                            <Label VerticalOptions="Start">
                                                <Label.FormattedText>
                                                    <FormattedString>
                                                        <Span Text="Ghi chÃº: " FontSize="15" TextColor="Gray" />
                                                        <Span Text="{Binding Note, TargetNullValue='KhÃ´ng cÃ³'}" FontSize="15" TextColor="#444" />
                                                    </FormattedString>
                                                </Label.FormattedText>
                                            </Label>
                                        </HorizontalStackLayout>
                                    </VerticalStackLayout>
                                </VerticalStackLayout>

                                <!-- Cá»˜T PHáº¢I: CÃC NÃšT THAO TÃC -->
                                <VerticalStackLayout Grid.Column="1" 
                                                     Spacing="18" 
                                                     VerticalOptions="Center">

                                    <Button Text="LiÃªn há»‡" 
                                            FontSize="12" 
                                            HeightRequest="30"
                                            Padding="0"
                                            BackgroundColor="#27AE60" 
                                            TextColor="White" 
                                            CornerRadius="5"
                                            Command="{Binding Source={RelativeSource AncestorType={x:Type vm:JobViewModel}}, Path=CallCustomerCommand}"
                                            CommandParameter="{Binding .}" />

                                    <Button Text="Báº£n Ä‘á»“" 
                                            FontSize="12" 
                                            HeightRequest="30"
                                            Padding="0"
                                            BackgroundColor="#E67E22" 
                                            TextColor="White" 
                                            CornerRadius="5"
                                            Command="{Binding Source={RelativeSource AncestorType={x:Type vm:JobViewModel}}, Path=GoToLocationCommand}"
                                            CommandParameter="{Binding .}" />

                                    <Button Text="Xong" 
                                            FontSize="12" 
                                            HeightRequest="30"
                                            Padding="0"
                                            BackgroundColor="RoyalBlue" 
                                            TextColor="White" 
                                            CornerRadius="5"
                                            Command="{Binding Source={RelativeSource AncestorType={x:Type vm:JobViewModel}}, Path=CompleteJobCommand}"
                                            CommandParameter="{Binding .}" />
                                </VerticalStackLayout>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </RefreshView>

        <!-- NÃšT THÃŠM Má»šI (+) -->
        <Button Text="+" FontSize="30" WidthRequest="60" HeightRequest="60"
                BackgroundColor="RoyalBlue" TextColor="White"
                HorizontalOptions="End" VerticalOptions="End"
                Margin="20" CornerRadius="30"
                Command="{Binding AddJobCommand}" />

        <!-- HIá»†U á»¨NG Táº¢I TRANG -->
        <ActivityIndicator IsRunning="{Binding IsBusy}" IsVisible="{Binding IsBusy}"
                           VerticalOptions="Center" HorizontalOptions="Center" Color="RoyalBlue" />
    </Grid>
</ContentPage>